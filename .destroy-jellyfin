#!/bin/bash

# Exit script on any errors
set -e

usage() {
  cat << USAGE
Usage: $(basename $0) [-fh]
This script PERMANENTLY DESTROYS the Jellyfin Media Server based out of
this directory by removing its configuration files.

Options:
  -f  force delete without prompt
  -h  display usage information
USAGE
}

# -- MAIN --

# Handle options
while getopts 'fh' opt; do
  case "$opt" in
    f)
      force_destroy=1
      ;;
    ?|h)
      usage
      exit
      ;;
  esac
done
shift "$(($OPTIND -1))"

echo "Destroying Jellyfin Media Server (configuration only)"
if [[ -z "${force_destroy}" ]] ; then
   read -p "Press any key to EXIT or enter 'DESTROY' to permanently destroy)? " response
   [[ "${response}" == 'DESTROY' ]] || exit
fi

jellyfin_server_file_dirs=(
  .env
  .jellyfin-server
)

for file_dir in ${jellyfin_server_file_dirs[@]}; do
  if [[ -e "${file_dir}" ]] ; then
    echo "Removing '${file_dir}'"
    rm -rf "${file_dir}"
  fi
done
